# **Crack Chat Downloader (크랙 채팅 다운로더)**

**CCD**는 크랙에 **채팅 내용 저장**(`HTML` `TXT` `JSON`) 기능을 추가하는 유저스크립트입니다.

## 소개

  - **Crack_Chat_Downloader**: 원본 스크립트입니다. **이쪽을 설치하세요**.
  - **Test_Code**: 추가 기능 실험장입니다. 안내가 있을 시에만 설치하세요.

## 1️⃣ 설치하기

### 확장 프로그램 설치

유저스크립트 사용을 위해, 먼저 유저스크립트 매니저를 설치합니다.

  -   [**Tampermonkey**](https://www.tampermonkey.net/)에서 사용 중인 브라우저에 맞는 버전 설치

### 유저스크립트 설치
아래 버튼을 클릭하거나, 직접 설치 링크를 통해 CCD를 설치합니다.

[![Static Badge](https://img.shields.io/badge/%E2%9A%99%EF%B8%8F%20INSTALL-crack_chat_downloader-blue?style=for-the-badge)](https://github.com/kktcct001/crack_chat_downloader/raw/refs/heads/main/Crack_Chat_Downloader.user.js)

**직접 설치 링크**:

```
https://raw.githubusercontent.com/kktcct001/crack_chat_downloader/refs/heads/main/Crack_Chat_Downloader.user.js
```

## 2️⃣ 사용하기

### 1. 채팅 내용 저장

CCD 설치 후, 크랙 채팅방에서 페이지를 새로 고치면 화면에 **채팅 내용 저장** 버튼이 추가됩니다.

- [**PC**] 채팅방 상단 헤더에 추가
- [**모바일**] 채팅방 설정 메뉴 하단에 추가

    > **Q. 모바일에서 채팅방 설정 메뉴 하단이 잘립니다.**
    >
    > 메뉴에 스크롤 기능이 적용되어 있습니다. 아래로 스크롤하여 버튼을 클릭하세요.

### 2. 채팅 저장 설정

채팅 내용 저장 버튼 클릭 후, **채팅 저장 설정** 창에서 원하는 옵션을 선택합니다.

#### 📘 현재 채팅 저장

**현재 보고 있는 채팅방의 대화만 저장**합니다.

  -  [**저장할 턴**] 최소 1턴부터 최대 1000턴까지 입력 (1턴 = 사용자 입력 + 어시스턴트 출력)
  -  [**저장할 순서**] `시작 대화 + n(저장할 턴)`만큼 저장할지, `최신 대화 - n(저장할 턴)`만큼 저장할지 선택
  
     > ***100턴이 누적된 채팅방이라고 가정***
     >
     > *1턴 ~ 50턴 내용이 필요한 경우* → *저장할 턴 50 + **시작 대화부터 저장***
     >
     > *50턴 ~ 100턴 내용이 필요한 경우* → *저장할 턴 50 + **최신 대화부터 저장*** 
       
  -  [**저장할 파일**]  `HTML` `TXT` `JSON` 버튼 클릭 → 자동 다운로드
  -  [**클립보드에 복사하기**]  체크하고 다운로드 → 클립보드에 자동 복사

#### 📚 전체 채팅 저장

현재 보고 있지 않은 **다른 채팅방 대화까지 모두 저장**합니다. 

- CCD의 전체 채팅 저장 기능은 **케츠** 님의 [**뤼튼 크랙 채팅 백업 스크립트**](https://github.com/tincansimagine/crack_backup) 중, **전체 채팅 백업** 기능에서 영감을 받았습니다.
  - MIT License에 따라, 해당 아이디어를 CCD에 적용했습니다.
  - 단, 기존 DOM 스크래핑 방식에서 API 호출 방식으로 로직을 재구성하였습니다.
  - 훌륭한 아이디어를 제공해 주신 케츠 님께 깊은 감사를 드립니다.

> **⚠ 어떻게 작동하나요?**
>
> 먼저, 서버에 모든 채팅방 목록을 가져오라고 요청합니다.
>
> 그다음, 각 채팅방의 대화를 순서대로 불러와 **하나의 HTML 파일**로 저장합니다.
>
> **⚠ 왜 주의가 필요한가요?**
>
> 서버에 짧은 시간에 많은 요청을 보냅니다. 100개의 채팅방이 있으면, 100번 이상의 요청이 발생합니다.
> 
> 해당 기능을 악용하여 짧은 시간에 반복적으로 사용할 경우, 크랙에서 **공격 시도로 간주하여 IP를 차단할 수 있습니다**.
>
> **⚠ 어떻게 사용하나요?**
>
> 꼭 필요할 때만 사용하되, 각각의 시도마다 적어도 **5분 이상** 간격을 두고 사용하세요.

## 3️⃣ 활용하기

### 1. HTML 페이지 이용

CCD의 HTML 파일은 자바스크립트(JavaScript) 코드를 내장하여, 웹앱처럼 작동합니다.

### 버튼 안내
  
[**PC**] 화면 오른쪽 아래에 버튼 고정

[**모바일**] 화면 스크롤 시 버튼 표시

- `☰` 사이드 메뉴 펼치기

    > **모바일의 전체 채팅 저장에서만 표시**
    > 
    > PC는 화면 왼쪽에 있는 **토글 버튼**을 클릭하여 사이드 메뉴 펼치기

  [**사이드 메뉴 버튼**]
  
    - `🧾` 채팅방 목록 클릭 시 클릭한 채팅방으로 이동
    - `🔎` 채팅 검색 기능
    - `📒` 유저 노트 기능
      
- `📝` 편집 모드 전환

   > **편집 모드는 현재 채팅 저장에서만 지원**
   > 
   > 메시지를 클릭하여 선택 후, 선택한 메시지를 일괄 삭제
   > 
   > 메시지 개별 삭제는 보기 모드에서 **쓰레기통 아이콘** 클릭
   > 
   > 잘못된 메시지를 삭제했을 때는 **페이지를 새로 고치면 복구**
   >
   > 메시지를 삭제한 뒤 화면 하단에 나타나는 **변경 사항 저장** 버튼을 클릭하여 새로운 HTML 파일을 다운로드

- `⬆️` 페이지의 맨 위로 이동
- `⬇️` 페이지의 맨 아래로 이동


> ⚠ iOS(Safari)에서는 보안 정책에 따라, HTML 파일의 **자바스크립트 코드 실행을 차단하여 버튼 상호작용이 불가능**합니다.
>
> ⚠ iOS(Safari)에서는 원활한 HTML 페이지 이용을 위해, 가급적 **앱스토어에서 HTML 뷰어 앱을 설치하세요**.

### 2. 버너 출력

[**버너가 멈춰도 버너 문학을 즐겨보자**](https://gall.dcinside.com/mini/board/view/?id=wrtnw&no=85829&exception_mode=recommend&page=1)

- 캐즘 버너 오류 발생 시, CCD를 통해 임시로 **버너 결과물**을 받아볼 수 있습니다.
  
    ➊  CCD를 통해 `JSON` 파일을 다운로드받습니다.
  
    ➋  `Gemini` `ChatGPT` 등, 사용하는 LLM에게 버너 요약 프롬프트, 또는 소설 / HTML 출력 프롬프트를 입력합니다.
  
    ➌  다운로드받은 `JSON` 파일을 전송합니다.
       
    ➍  출력된 채팅 요약본을 복사하고, 크랙 채팅방에서 일반챗으로 붙여넣습니다.

    ➎  대화가 누적되어 다시 요약이 필요해진 경우, ➊ → ➌ → ➍ 과정을 반복합니다.
  
 ---
 
[**저장 양식**]

  `HTML` **크랙 채팅방과 비슷한 UI로 저장**
     
  `TXT` **아래의 양식대로 저장 및 복사**
     
  ```
  [assistant message]  // 역할 구분

  원본 채팅 내용

  ===  // 구분자

  [user message]

  원본 채팅 내용
  ```
     
  `JSON` **아래의 양식대로 저장 및 복사**
     
  ```
  [
    {
      "role": "역할 구분",
      "content": "원본 채팅 내용"
    }
  ]
   ```
     
> ‼︎  **HTML**/**TXT**는 아래로 내려갈수록 시작 대화에서 최신 대화로, **순서대로 정렬되어 있습니다**.
> 
> ‼︎  **JSON**은 아래로 내려갈수록 최신 대화에서 시작 대화로, **역순으로 정렬되어 있습니다**.
